<div class="filters-container" data-controller="filter">
  <%= form_with(url: tournaments_path, method: :get, data: tournament_search_data_attributes) do |f| %>
    
    <!-- Barra de bÃºsqueda principal -->
    <div class="search-input-container">
      <div class="search-input-icon">
        <%= render 'shared/icons/search', class: 'icon-small text-slate-400' %>
      </div>
      <%= f.text_field :query, 
                    value: params[:query], 
                    placeholder: "Buscar torneos...", 
                    class: "search-input",
                    autocomplete: "off",
                    data: search_input_data_attributes %>
      <% if params[:query].present? %>
        <div class="search-clear-button">
          <%= link_to tournaments_path, data: { turbo_frame: "tournaments_results" } do %>
            <%= render 'shared/icons/close', class: 'icon-small' %>
          <% end %>
        </div>
      <% end %>
    </div>
    
    <!-- Filtros horizontales -->
    <div class="filters-row">
      <!-- Etiqueta -->
      <div class="filters-label">
        <%= render 'shared/icons/filter', class: 'icon-small mr-2 text-blue-400' %>
        <span class="mobile-hidden">Filtrar por:</span>
        <span class="mobile-only">Filtros:</span>
      </div>
      
      <!-- Filtro por RegiÃ³n -->
      <%= render 'filter_select', 
          form: f, 
          field: :region, 
          label: 'RegiÃ³n', 
          options: @available_regions, 
          current_value: params[:region],
          type: 'region' %>
      
      <!-- Filtro por Ciudad -->
      <%= render 'filter_select', 
          form: f, 
          field: :city, 
          label: 'Ciudad', 
          options: @available_cities, 
          current_value: params[:city],
          type: 'city' %>
      
      <!-- Filtro por Estado (Pasados/Futuros) -->
      <div class="filter-group">
        <label for="status" class="text-sm text-slate-400 whitespace-nowrap mobile-hidden">Estado:</label>
        <%= f.select :status, 
                    options_for_select([['Todos', ''], ['Futuros', 'upcoming'], ['Pasados', 'past']], params[:status]),
                    {},
                    {
                      class: "filter-select filter-select-status",
                      data: filter_select_data_attributes
                    } %>
      </div>

      <!-- Filtro de Ordenamiento -->
      <div class="filter-group">
        <label for="sort" class="text-sm text-slate-400 whitespace-nowrap mobile-hidden">Ordenar:</label>
        <%= f.select :sort, 
                    options_for_select(sort_options_for_select, params[:sort] || 'newest'),
                    {},
                    {
                      class: "filter-select filter-select-sort",
                      data: filter_select_data_attributes,
                      value: params[:sort] || 'newest'
                    } %>
      </div>
      
      <!-- BotÃ³n para limpiar filtros -->
      <% if has_active_filters? %>
        <%= link_to clear_filters_path, 
                  class: "clear-filters-button", 
                  data: { turbo_frame: "tournaments_results" } do %>
          <%= render 'shared/icons/close', class: 'icon-tiny mr-1' %>
          <span class="mobile-hidden">Limpiar</span>
          <span class="mobile-only">âœ•</span>
        <% end %>
      <% end %>
      

    </div>
    
    <!-- Filtros de fecha -->
    <div class="filters-row date-filters-section">
      <div class="filters-label">
        <%= render 'shared/icons/calendar', class: 'icon-small mr-2 text-purple-400' %>
        <span class="mobile-hidden">Filtrar por fechas:</span>
        <span class="mobile-only">Fechas:</span>
      </div>
      
      <div class="filter-group">
        <label for="start_date" class="text-sm text-slate-400 whitespace-nowrap mobile-hidden">Desde:</label>
        <%= f.date_field :start_date, 
                        value: params[:start_date], 
                        class: "filter-select filter-select-date",
                        placeholder: "dd-mm-aaaa",
                        data: { action: "change->tournaments#applyFilters" } %>
      </div>
      
      <div class="filter-group">
        <label for="end_date" class="text-sm text-slate-400 whitespace-nowrap mobile-hidden">Hasta:</label>
        <%= f.date_field :end_date, 
                        value: params[:end_date], 
                        class: "filter-select filter-select-date",
                        placeholder: "dd-mm-aaaa",
                        data: { action: "change->tournaments#applyFilters" } %>
      </div>
      
      <% if params[:start_date].present? || params[:end_date].present? %>
        <%= link_to tournaments_path(query: params[:query], region: params[:region], city: params[:city], status: params[:status]), 
                    class: "clear-filters-button", 
                    data: { turbo_frame: "tournaments_results" } do %>
          <%= render 'shared/icons/close', class: 'icon-tiny mr-1' %>
          <span class="mobile-hidden">Limpiar fechas</span>
          <span class="mobile-only">âœ•</span>
        <% end %>
      <% end %>
    </div>
    
    <!-- BotÃ³n para limpiar TODOS los filtros incluyendo bÃºsqueda -->
    <div class="clear-all-button-container">
      <%= link_to clear_all_filters_path, 
                class: "clear-all-filters-button hidden", 
                data: { 
                  turbo_frame: "tournaments_results",
                  filter_target: "clearAllButton",
                  action: "click->filter#clearAllFilters"
                },
                title: "Limpiar todos los filtros y bÃºsqueda" do %>
        <%= render 'shared/icons/refresh', class: 'icon-tiny mr-1' %>
        <span class="mobile-hidden">Limpiar Todo</span>
        <span class="mobile-only">ðŸ”„</span>
      <% end %>
    </div>
    
    <!-- Mostrar filtros activos -->
    <%= render 'active_filters' if has_active_filters? %>
    
    <div class="help-info">
      <%= render 'shared/icons/info', class: 'help-icon' %>
      <span>La bÃºsqueda y filtros se aplican automÃ¡ticamente</span>
    </div>
  <% end %>
</div> 